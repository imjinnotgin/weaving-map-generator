
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Weaving Draft Map Generator</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        font-family: sans-serif;
      }
      #map {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        z-index: 0;
      }
      canvas {
        position: absolute;
        top: 0; left: 0;
        z-index: 1;
        pointer-events: none;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
  </head>
  <body>
    <div id="map"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      let lat = 0, lon = 0;
      let canvas;

      function setup() {
        canvas = createCanvas(700, 700);
        canvas.position((windowWidth - 700) / 2, (windowHeight - 700) / 2);
        noLoop();
        drawWeave();
      }

      function drawWeave() {
        background(255);
        stroke(0);
        noFill();
        let grid = 20;
        let rand = randomSeed(lat + lon);
        for (let y = 0; y < height; y += grid) {
          for (let x = 0; x < width; x += grid) {
            if (random() < 0.5) {
              line(x, y, x + grid, y + grid);
            } else {
              line(x + grid, y, x, y + grid);
            }
          }
        }
      }

      const map = L.map('map').setView([37.5665, 126.9780], 10); // Seoul default
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);

      map.on('click', function(e) {
        lat = e.latlng.lat;
        lon = e.latlng.lng;
        redraw();
      });

      function windowResized() {
        canvas.position((windowWidth - 700) / 2, (windowHeight - 700) / 2);
      }
    </script>
  </body>
</html>
