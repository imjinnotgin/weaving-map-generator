
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Weaving Draft Map Generator</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        font-family: sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #container {
        display: flex;
        width: 100%;
        height: 100%;
      }
      #map {
        flex: 1;
        height: 100%;
        z-index: 0;
      }
      canvas {
        width: 50%;
        height: 100%;
        z-index: 1;
        position: absolute;
        left: 0;
        top: 0;
        pointer-events: none;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
  </head>
  <body>
    <div id="container">
      <div id="map"></div>
      <canvas id="weavingPattern"></canvas>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      let lat = 0, lon = 0;
      let canvas;
      let pattern = [];
      
      function setup() {
        canvas = createCanvas(windowWidth / 2, windowHeight);
        canvas.position(0, 0);
        noLoop();
        drawWeave();
      }

      function drawWeave() {
        background(255);
        stroke(0);
        noFill();
        let grid = 20;
        let rand = randomSeed(lat + lon);
        pattern = [];
        for (let y = 0; y < height; y += grid) {
          for (let x = 0; x < width; x += grid) {
            if (random() < 0.5) {
              line(x, y, x + grid, y + grid);
            } else {
              line(x + grid, y, x, y + grid);
            }
          }
        }
      }

      const map = L.map('map').setView([37.5665, 126.9780], 10); // Default to Seoul
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);

      map.on('click', function(e) {
        lat = e.latlng.lat;
        lon = e.latlng.lng;
        redraw();
      });

      function windowResized() {
        canvas.position(0, 0);
      }
    </script>
  </body>
</html>
